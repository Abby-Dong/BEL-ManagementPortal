<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Header Filter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-header {
            background: #004280;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .test-content {
            padding: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background: #d0e6d4; color: #025324; }
        .warning { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>Header Filter Integration Test</h1>
            <p>Testing the new header-based year filter functionality</p>
        </div>
        
        <div class="test-content">
            <div class="test-section">
                <h3>üîç Test 1: DOM Elements Check</h3>
                <p>Checking if all required header filter elements exist...</p>
                <button onclick="testDOMElements()">Run Test</button>
                <div id="dom-test-result" class="test-result"></div>
            </div>
            
            <div class="test-section">
                <h3>üìä Test 2: Year Data Detection</h3>
                <p>Checking if years are correctly detected from data...</p>
                <button onclick="testYearDetection()">Run Test</button>
                <div id="year-test-result" class="test-result"></div>
            </div>
            
            <div class="test-section">
                <h3>üéõÔ∏è Test 3: Filter Functionality</h3>
                <p>Testing filter dropdown show/hide behavior...</p>
                <button onclick="testFilterFunctionality()">Run Test</button>
                <div id="filter-test-result" class="test-result"></div>
            </div>
            
            <div class="test-section">
                <h3>üìà Test 4: Year Selection Impact</h3>
                <p>Testing if year selection triggers dashboard updates...</p>
                <button onclick="testYearSelection()">Run Test</button>
                <div id="selection-test-result" class="test-result"></div>
            </div>
            
            <div class="test-section">
                <h3>üì± Test 5: Mobile Responsiveness</h3>
                <p>Testing filter dropdown on smaller screens...</p>
                <button onclick="testMobileView()">Run Test</button>
                <div id="mobile-test-result" class="test-result"></div>
            </div>
        </div>
    </div>

    <script>
        // Load the main portal in an iframe to test functionality
        const iframe = document.createElement('iframe');
        iframe.src = './index.html';
        iframe.style.display = 'none';
        document.body.appendChild(iframe);
        
        function getIframeDocument() {
            return iframe.contentDocument || iframe.contentWindow.document;
        }
        
        function testDOMElements() {
            const result = document.getElementById('dom-test-result');
            
            iframe.onload = () => {
                try {
                    const doc = getIframeDocument();
                    const filterBtn = doc.querySelector('.bel-filter-btn');
                    const filterPanel = doc.querySelector('.bel-filter-panel');
                    const yearSelect = doc.getElementById('header-year-filter');
                    const regionSelect = doc.getElementById('header-region-filter');
                    
                    const checks = [
                        { name: 'Filter Button', element: filterBtn },
                        { name: 'Filter Panel', element: filterPanel },
                        { name: 'Year Select', element: yearSelect },
                        { name: 'Region Select', element: regionSelect }
                    ];
                    
                    const results = checks.map(check => 
                        `${check.element ? '‚úÖ' : '‚ùå'} ${check.name}: ${check.element ? 'Found' : 'Missing'}`
                    );
                    
                    const allFound = checks.every(check => check.element);
                    result.className = `test-result ${allFound ? 'success' : 'error'}`;
                    result.innerHTML = results.join('<br>');
                    
                } catch (error) {
                    result.className = 'test-result error';
                    result.innerHTML = `‚ùå Error: ${error.message}`;
                }
            };
        }
        
        function testYearDetection() {
            const result = document.getElementById('year-test-result');
            
            iframe.onload = () => {
                try {
                    const doc = getIframeDocument();
                    const yearSelect = doc.getElementById('header-year-filter');
                    
                    if (yearSelect) {
                        const options = Array.from(yearSelect.options).map(opt => opt.value);
                        const hasAllYears = options.includes('all');
                        const yearOptions = options.filter(opt => opt !== 'all');
                        
                        result.className = 'test-result success';
                        result.innerHTML = `
                            ‚úÖ Year options detected: ${yearOptions.join(', ')}<br>
                            ‚úÖ "All Years" option: ${hasAllYears ? 'Present' : 'Missing'}<br>
                            ‚úÖ Total options: ${options.length}
                        `;
                    } else {
                        result.className = 'test-result error';
                        result.innerHTML = '‚ùå Year selector not found';
                    }
                } catch (error) {
                    result.className = 'test-result error';
                    result.innerHTML = `‚ùå Error: ${error.message}`;
                }
            };
        }
        
        function testFilterFunctionality() {
            const result = document.getElementById('filter-test-result');
            
            iframe.onload = () => {
                try {
                    const doc = getIframeDocument();
                    const filterBtn = doc.querySelector('.bel-filter-btn');
                    const filterPanel = doc.querySelector('.bel-filter-panel');
                    
                    if (filterBtn && filterPanel) {
                        // Test click to show
                        filterBtn.click();
                        const isShownAfterClick = filterPanel.classList.contains('show');
                        
                        // Test click to hide
                        filterBtn.click();
                        const isHiddenAfterSecondClick = !filterPanel.classList.contains('show');
                        
                        result.className = 'test-result success';
                        result.innerHTML = `
                            ${isShownAfterClick ? '‚úÖ' : '‚ùå'} Panel shows on click<br>
                            ${isHiddenAfterSecondClick ? '‚úÖ' : '‚ùå'} Panel hides on second click
                        `;
                    } else {
                        result.className = 'test-result error';
                        result.innerHTML = '‚ùå Filter elements not found';
                    }
                } catch (error) {
                    result.className = 'test-result error';
                    result.innerHTML = `‚ùå Error: ${error.message}`;
                }
            };
        }
        
        function testYearSelection() {
            const result = document.getElementById('selection-test-result');
            
            iframe.onload = () => {
                try {
                    const doc = getIframeDocument();
                    const yearSelect = doc.getElementById('header-year-filter');
                    
                    if (yearSelect && yearSelect.options.length > 1) {
                        // Get initial value
                        const initialValue = yearSelect.value;
                        
                        // Change to different year
                        const newValue = yearSelect.options[1].value;
                        yearSelect.value = newValue;
                        yearSelect.dispatchEvent(new Event('change'));
                        
                        // Check if global variable was updated
                        const globalYear = iframe.contentWindow.selectedDashboardYear;
                        
                        result.className = 'test-result success';
                        result.innerHTML = `
                            ‚úÖ Initial value: ${initialValue}<br>
                            ‚úÖ Changed to: ${newValue}<br>
                            ‚úÖ Global variable: ${globalYear}<br>
                            ${globalYear === newValue ? '‚úÖ' : '‚ùå'} Global variable updated correctly
                        `;
                    } else {
                        result.className = 'test-result warning';
                        result.innerHTML = '‚ö†Ô∏è Not enough year options to test selection';
                    }
                } catch (error) {
                    result.className = 'test-result error';
                    result.innerHTML = `‚ùå Error: ${error.message}`;
                }
            };
        }
        
        function testMobileView() {
            const result = document.getElementById('mobile-test-result');
            
            iframe.onload = () => {
                try {
                    const doc = getIframeDocument();
                    const filterPanel = doc.querySelector('.bel-filter-panel');
                    
                    if (filterPanel) {
                        // Get computed styles for mobile check
                        const styles = iframe.contentWindow.getComputedStyle(filterPanel);
                        
                        result.className = 'test-result success';
                        result.innerHTML = `
                            ‚úÖ Panel position: ${styles.position}<br>
                            ‚úÖ Z-index: ${styles.zIndex}<br>
                            ‚úÖ Min-width: ${styles.minWidth}<br>
                            ‚úÖ CSS rules applied successfully
                        `;
                    } else {
                        result.className = 'test-result error';
                        result.innerHTML = '‚ùå Filter panel not found';
                    }
                } catch (error) {
                    result.className = 'test-result error';
                    result.innerHTML = `‚ùå Error: ${error.message}`;
                }
            };
        }
    </script>
</body>
</html>
